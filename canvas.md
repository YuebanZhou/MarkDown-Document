# canvas

## 简介

+ canvas最早由Apple引入WebKit，用于Mac OS X 的Dashboard，后来又在Safari和Google Chrome中实现

+ 基于gecko 1.8浏览器，比如Firefox 1.5，同样支持这个元素

+ canvas元素是WhatWG Web application 1.0的一部分，也包含于HTML5

+ H5的canvas元素使用JavaScript在网页上绘制图像，默认大小是300*150，可以自主设置宽高，不建议设置在style样式中

+ 浏览器解析的时候是图片，可以控制每一像素

+ canvas不是块级元素，所以居中的时候需要用display转化一下

+ canvas拥有多种绘制路径、矩形、圆形、字符以及添加图像的方法

## 绘制步骤

+ 先获取元素，之后获取工具，再设置起始位置，之后绘制路径，最后描边

+ 描边过程可以设置线条颜色

+ 再次绘制的时候会使用之前的样式，后面的样式覆盖前面的

  ```html
  <script>
    var canvas=document.querySelector('canvas');
    var ctx=canvas.getContext('2d');
    ctx.moveTo(100,100);
    ctx.lineTo(200,100);
    ctx.stroke();
  </script>
  ```

## 绘制

### 基本绘制

- 线默认是1px，黑色。canvas由像素点组成，以坐标的中心绘制。如果是1px的线条，会被坐标中心分成两部分，每部分0.5px，浏览器无法显示0.5px，所以显示成浅色的粗线条。
- 如果线条的宽度是偶数的，就不会有这种情况。不过这种效果一般可以忽略。
- beginPath表示重新绘制一条线，后面没有设置的样式会沿袭前边线条的样式
- 手动闭合，会产生缺口效果
- 自动闭合closePath
- 填充fill
- 不管是手动闭合还是自动闭合，或者是不封闭，都不会影响填充效果
- 两端样式用lineCap属性设置，默认是butt，还有round和square值，设置成后两种的时候，线条会比默认稍长 
- 设置moveTo和lineTo，形成拐点，默认样式是miter，还有round和bevel值
- 渐变可以看成，线条中的每个像素分别设置颜色。那么渐变效果用遍历线条中的每个像素就可以实现
- 遍历一次，线条的起点moveTo和lineTo就会发生改变

### 非零绘制原则

* 从某区域伸出一条线，经过这条线的路径，顺时针方向+1，逆时针方向-1。最终路径值的和是0，则这个区域就不填充。是0就填充

### 虚线

- 用setLineDash设置虚线


- 传入一个数组，数组中的数据依次表示实点空白
- 如果传入的是奇数个数据，比如5,10,15，
- 那么表示实点5、空白10、实点15、空白5、实点10、空白15
- 奇数总会转换成偶数个数据
- 另外虚线还有偏移量，负值表示向右偏移

### 矩形

* 所有的方法中，前两个参数表示相对于canvas坐标，x和y，后两个参数表示矩形的大小，长和宽
* rect没有自己独立的路径，设置完坐标和大小时候，还需要手动描边或填充
* strokeRect和fillRect都有自己的路径，可以直接生成矩形，一个标识描边生成，另一个是填充生成
* clearRect清除绘制内容

### 渐变方案

* createLinearGradient前两个参数表示起点的坐标，后两个参数表示终点坐标
* addColorStop表示颜色的设置，第一个参数表示占据位置，第二个参数是颜色

### 圆弧

* 圆弧绘制arc方法有六个参数
* 前两个参数表示圆心的坐标，第三个参数表示圆弧的半径，第四个参数表示开始的弧度，第五个参数表示结束的弧度，第六个参数表示绘制方向，默认值是false顺时针
* 一个弧度的长度等于半径的长度，一个周长等于2*π个弧度
* 周长是2*Math.PI*r，一个角度就是Math.PI/180
* 顺时针转是正方向，是正值。逆时针转是负方向是负值

### 文本

* 文本设置，font设置字体样式和大小
* strokeText表示字体描边，fillText表示字体填充，这两个方法有四个参数，第一个参数表示要表示出来的文本，第二个和第三个参数表示坐标（文本的左下角），第四个参数表示文本最大宽度，可以不设置
* textAlign表示文本左右方向的对齐方式，有left，right，center，start，end...
* textBaseline表示文本上下的对齐方式，有top，middle，bottom，alphabetic（默认值）
* measureText方法获取文本的宽度
* 文本的对齐都是相对于坐标点来确定的
* 如果设定起始点的坐标是(100,100)那么向右对齐的时候，文本会出现在(100,100)的左边，上下方式的对齐方式同理

### 图片

* 创建一个存在于内存中的图片，有下面两种方式
* 文档中创建元素，设定元素的路径等属性
* 使用Img对象new一个图片
* 在IE浏览器中，图片加载之后会有缓存，在onload的时候图片可能已经加载出来了，所以要把获取图片的语句放在onload之后
* canvas中绘制图片有三种方式
  + 第一种，三个参数
    + 参数一，图片对象。参数二，坐标x。参数三，坐标y。
  + 第二种，五个参数
    + 参数一，图片对象。参数二，坐标x。参数三，坐标y。参数四，图片宽。参数五，图片高。
  + 第三种，九个参数
    + 参数一，图片对象。参数二，图片x轴定位。参数三，图片y轴定位。参数四，截取图片宽度。参数五，截取图片高度。参数六，绘制x坐标。参数七，绘制y坐标。参数八，绘制图片宽度。参数九，绘制图片高度。

### 精灵图

  * 从一大张精灵图中截取需要的部分
  * 获取画布的宽高，令图片居中显示
  * 九个参数中，获取img对象，在图片的(40,195)的位置截取图片，截取图片的大小是40X65，放在画布的(startX,startY)的位置，在画布中显示大小是40X65

### 帧动画

  * 获取画布大小，获取人物大小，得到绘制的起点
  * 设置索引值初始值为0，代表行列中的第几个图片
  * 绘制图片，在图片(0,0)位置截取图片，截取大小是人物大小，画布中绘制起点就是之前计算得到的结果，图片大小是人物大小。
  * 设置一个定时器，令index自加，如果index加到3，归零
  * 绘制图片之前先清除之前的图片，清除的起点是绘制图片的起点，清除范围的大小是人物的大小
  * 绘制新图片，截取位置的x方向长度是索引和人物宽度的乘积，y方向就是最后一行的坐标195，图片截取大小就是人物大小，开始位置就是绘制起始位置，画布中图片显示大小就是人物大小

### 转换坐标轴

  * CSS中translate 在移动的是元素
  * Canvas中 translate移动的事坐标轴
  * CSS中rotate旋转绕元素中心转，坐标轴方向发生改变
  * Canvas中 rotate旋转绕坐标轴原点，坐标轴方向发生改变
  * Canvas 中scale x轴的缩放 y轴的缩放 并不是元素的缩放

### 保存和恢复

  * 保存和恢复，保存多个系列，先保存的后被拿出，后保存的先被拿出。栈
  * 如果先保存一个红色宽30，再保存一个绿色宽20，之后恢复的时候，会先恢复